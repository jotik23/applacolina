{% load humanize form_extras %}
{% if form %}
  <div
    class="fixed inset-0 z-50 {% if not panel_open %}hidden{% endif %}"
    role="dialog"
    aria-modal="true"
    data-dispatch-panel
    data-dispatch-panel-embedded="{{ panel_embedded|yesno:'true,false' }}"
    data-dispatch-panel-open="{{ panel_open|yesno:'true,false' }}"
  >
    <div class="absolute inset-0 bg-slate-900/40 transition-opacity" data-dispatch-panel-backdrop></div>
    <div class="absolute inset-y-0 right-0 flex max-w-full pl-10">
      <section class="pointer-events-auto w-screen max-w-3xl">
        <div class="flex h-full min-h-0 flex-col overflow-hidden rounded-l-3xl bg-white/95 shadow-2xl ring-1 ring-slate-200/70 backdrop-blur-sm">
          <header class="relative flex items-center justify-between gap-6 border-b border-transparent bg-gradient-to-r from-emerald-50 via-white to-white px-7 py-6 shadow-sm">
            <div class="flex items-start gap-4">
              <span class="flex h-12 w-12 items-center justify-center rounded-2xl bg-white/80 text-emerald-600 shadow ring-1 ring-emerald-200">
                <svg class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                  <path
                    fill-rule="evenodd"
                    d="M7 3a1 1 0 00-1 1v1H5a2 2 0 00-2 2v10a2 2 0 002 2h14a2 2 0 002-2V7a2 2 0 00-2-2h-1V4a1 1 0 10-2 0v1H9V4a1 1 0 00-1-1zm12 5H5v9h14V8zm-9 3.5A1.5 1.5 0 019.5 10h5a1.5 1.5 0 010 3h-5A1.5 1.5 0 017 11.5zm0 3A1.5 1.5 0 018.5 13h3a1.5 1.5 0 010 3h-3A1.5 1.5 0 017 14.5z"
                    clip-rule="evenodd"
                  />
                </svg>
              </span>
              <div>
                <p class="text-xs font-semibold uppercase tracking-wide text-emerald-600">Cadena log√≠stica</p>
                <h2 class="mt-1 text-2xl font-semibold text-slate-900">{{ panel_title|default:"Registrar despacho" }}</h2>
                {% if panel_subtitle %}
                  <p class="mt-1 text-sm text-slate-500">{{ panel_subtitle }}</p>
                {% endif %}
              </div>
            </div>
            <a
              href="{{ panel_cancel_url|default:'#' }}"
              class="inline-flex h-9 w-9 items-center justify-center rounded-full border border-slate-200 text-slate-500 transition hover:border-emerald-200 hover:text-emerald-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-200 focus-visible:ring-offset-2"
              data-dispatch-panel-close
            >
              <span class="sr-only">Cerrar panel</span>
              <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M5.22 5.22a.75.75 0 011.06 0L10 8.94l3.72-3.72a.75.75 0 111.06 1.06L11.06 10l3.72 3.72a.75.75 0 11-1.06 1.06L10 11.06l-3.72 3.72a.75.75 0 11-1.06-1.06L8.94 10 5.22 6.28a.75.75 0 010-1.06z" clip-rule="evenodd" />
              </svg>
            </a>
          </header>
          <form
            method="post"
            action="{{ panel_form_action|default:request.path }}"
            class="flex flex-1 flex-col bg-gradient-to-b from-white via-white to-slate-50 min-h-0"
            data-dispatch-form
            novalidate
          >
            {% csrf_token %}
            {% if panel_embedded %}
              <input type="hidden" name="embedded_panel" value="1">
            {% endif %}
            <div class="flex-1 min-h-0 space-y-6 overflow-y-auto px-7 py-6">
              {% include "administration/dispatches/includes/form_fields.html" with form=form type_rows=type_rows inventory_total=inventory_total dispatch=dispatch %}
            </div>
            <div class="flex flex-wrap items-center justify-between gap-3 border-t border-slate-100 bg-slate-50/80 px-7 py-5 text-sm font-semibold text-slate-600 backdrop-blur-sm">
              <a
                href="{{ panel_cancel_url|default:'#' }}"
                class="inline-flex items-center gap-2 rounded-lg border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-600 transition hover:border-slate-300 hover:text-slate-800"
                data-dispatch-panel-close
              >
                Cancelar
              </a>
              <button
                type="submit"
                class="inline-flex items-center gap-2 rounded-lg bg-emerald-600 px-5 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400 focus-visible:ring-offset-2 focus-visible:ring-offset-slate-50"
              >
                {{ panel_submit_label|default:"Guardar" }}
              </button>
            </div>
          </form>
        </div>
      </section>
    </div>
  </div>
{% endif %}
