<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Calendario compartido | {{ calendar.name|default:"Calendario operativo" }}</title>
    <style>
      :root {
        color-scheme: light;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background-color: #f8fafc;
        color: #0f172a;
      }
      main {
        max-width: 1100px;
        margin: 0 auto;
        padding: 2rem 1.5rem 3rem;
      }
      header {
        margin-bottom: 1.5rem;
      }
      h1 {
        font-size: 1.5rem;
        margin: 0;
        color: #0f172a;
      }
      p {
        margin: 0.25rem 0;
        color: #334155;
      }
      .meta {
        font-size: 0.95rem;
        color: #475569;
      }
      .table-wrapper {
        overflow-x: auto;
        border: 1px solid #e2e8f0;
        border-radius: 0.75rem;
        background-color: #fff;
        box-shadow: 0 10px 20px rgba(15, 23, 42, 0.05);
      }
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9rem;
      }
      caption {
        text-align: left;
        font-weight: 600;
        padding: 1rem;
        color: #0f172a;
      }
      thead th {
        background-color: #f1f5f9;
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.05em;
        color: #475569;
      }
      th,
      td {
        border: 1px solid #e2e8f0;
        padding: 0.75rem;
        text-align: left;
      }
      th.position-cell {
        width: 240px;
        background-color: #f8fafc;
        font-weight: 600;
      }
      th span {
        display: block;
        font-size: 0.75rem;
        color: #64748b;
        font-weight: 500;
      }
      td.cell-empty {
        color: #cbd5f5;
        font-style: italic;
      }
      td {
        min-width: 120px;
      }
      .rest-section {
        margin-top: 2.5rem;
        padding: 1.5rem;
        border-radius: 0.75rem;
        border: 1px solid #e2e8f0;
        background-color: #fff;
        box-shadow: 0 10px 20px rgba(15, 23, 42, 0.05);
      }
      .rest-section h2 {
        margin: 0 0 1rem;
        font-size: 1.1rem;
        color: #0f172a;
      }
      .rest-table {
        width: 100%;
        border-collapse: collapse;
      }
      .rest-table th {
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.05em;
        color: #475569;
        text-align: left;
      }
      .rest-table th,
      .rest-table td {
        border: 1px solid #e2e8f0;
        padding: 0.65rem;
      }
      .empty-state {
        margin-top: 1rem;
        font-size: 0.95rem;
        color: #475569;
      }
      footer {
        margin-top: 2rem;
        font-size: 0.8rem;
        color: #94a3b8;
      }
    </style>
  </head>
  <body>
    <main>
      <header>
        <h1>{{ calendar.name|default:"Calendario operativo" }}</h1>
        <p class="meta">Rango compartido: {{ range_label }}</p>
        <p class="meta">Áreas incluidas: {{ area_label }}</p>
        <p class="meta">Calendario base: {{ calendar.start_date|date:"d M" }} → {{ calendar.end_date|date:"d M Y" }}</p>
      </header>

      <section>
        <div class="table-wrapper">
          <table>
            <caption>Asignaciones por día</caption>
            {% if rows %}
              <thead>
                <tr>
                  <th class="position-cell">Posición</th>
                  {% for day in date_columns %}
                    <th>
                      {{ day|date:"D d/M" }}
                    </th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for row in rows %}
                  <tr>
                    <th class="position-cell" scope="row">
                      {{ row.position_label }}
                      {% if row.position_code %}
                        <span>Código {{ row.position_code }}</span>
                      {% endif %}
                      {% if row.farm_name %}
                        <span>{{ row.farm_name }}</span>
                      {% endif %}
                    </th>
                    {% for cell in row.cells %}
                      <td class="{% if cell.is_empty %}cell-empty{% endif %}">
                        {{ cell.value }}
                      </td>
                    {% endfor %}
                  </tr>
                {% endfor %}
              </tbody>
            {% else %}
              <tbody>
                <tr>
                  <td class="position-cell" colspan="{{ date_columns|length|add:'1' }}">No hay turnos programados en este rango.</td>
                </tr>
              </tbody>
            {% endif %}
          </table>
        </div>
        {% if not rows %}
          <p class="empty-state">No se registran asignaciones disponibles entre estas fechas.</p>
        {% endif %}
      </section>

      {% if rest_entries %}
        <section class="rest-section">
          <h2>Descansos programados</h2>
          <table class="rest-table">
            <thead>
              <tr>
                <th>Colaborador</th>
                <th>Rango</th>
                <th>Estado</th>
              </tr>
            </thead>
            <tbody>
              {% for entry in rest_entries %}
                <tr>
                  <td>{{ entry.operator }}</td>
                  <td>{{ entry.span }}</td>
                  <td>{{ entry.status }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </section>
      {% endif %}

      <footer>
        Vista informativa de solo lectura · Generada el {{ generated_at|date:"d/m/Y H:i" }} (GMT-5 aproximado).
      </footer>
    </main>
  </body>
</html>
